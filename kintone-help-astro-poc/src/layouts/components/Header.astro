---
import { env } from "@/lib/env";
import SearchBox from "./SearchBox.astro";
import LangSelector from "./LangSelector.astro";
import type { BaseProps } from "./types";

interface Props extends BaseProps {}

const { page } = Astro.props;

// ヘッダークラスの決定
let hedclass = "";
if (page.isHome && !env.meganav) {
  hedclass = "home-header";
} else if (page.isHome && env.targetRegion === "US") {
  hedclass = "home-header";
}

// ベースURLの計算
const urlparts = env.baseURL.split("/");
const productPos = urlparts.length - 2;
const base = `/${urlparts[productPos]}/`;
const baseLink = `${base}${page.lang}/`;

// サーチボックス表示の判定
let dispSbox = true;
if (page.frontmatter.type === "search_result") {
  dispSbox = false;
} else if (page.isHome) {
  dispSbox = false;
} else if (env.previewSite) {
  dispSbox = false;
}

// ロゴ/タイトルの決定
const logoAlt = `${env.productName} ${env.help}`;

// TODO: productパラメータによるv2_prod判定の復活が必要
// Hugoテンプレートでは以下の判定が存在していた:
// v2_list := slice "kintone" "slash" "support_guide" "store" "store-jp"
// $v2_prod := false
// if in $v2_list $.Site.Params.product
//   $v2_prod = true
// 現在はkintone固定によりこの判定が削除されているが、
// 将来的にslash, store, support_guideのサポートが必要になった場合は
// この判定を復活させる必要がある

// shouldUseImage が常に true のため logoTitle は不要
// let logoTitle = "";
---

<div id="shield"></div>
<header id="header" class={`header ${hedclass}`}>
  <div id="head" class="header-wrap">
    <div class="logo-wrap">
      {
        !page.isHome && (
          <button id="tree-switch-mobile" class="tree-switch-mobile">
            <i class="fas fa-bars" aria-hidden="true" />
          </button>
        )
      }

      <h1>
        <a class="logo-link" href={baseLink}>
          <img
            class="logo-img"
            src={`${base}${env.logo}`}
            alt={logoAlt}
            title={logoAlt}
          />
        </a>
      </h1>
    </div>

    {dispSbox && <SearchBox page={page} />}

    {
        env.langSelector && (
          <LangSelector
            relPermalink={page.relPermalink}
          />
        )
    }
  </div>
</header>
