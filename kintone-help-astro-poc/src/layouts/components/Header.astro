---
interface Props {
  isHome?: boolean;
  meganav?: boolean;
  targetRegion?: string;
  product?: string;
  templateVersion?: string;
  lang: string;
  allTranslations?: any[];
  baseURL: string;
  productName: string;
  help: string;
  logo?: string;
  siteName: string;
  previewSite?: boolean;
  pageType?: string;
  searchWordLabel: string;
  enterKeywordsLabel: string;
  searchLabel: string;
  googleSearch?: boolean;
  searchAll?: string;
  langSelector?: boolean;
  isTranslated?: boolean;
}

const { 
  isHome = false,
  meganav = false,
  targetRegion = "",
  product = "",
  templateVersion = "1",
  lang,
  allTranslations = [],
  baseURL,
  productName,
  help,
  logo,
  siteName,
  previewSite = false,
  pageType = "",
  searchWordLabel,
  enterKeywordsLabel,
  searchLabel,
  googleSearch = false,
  searchAll = "",
  langSelector = false,
  isTranslated = false
} = Astro.props;

// ヘッダークラスの決定
let hedclass = "";
if (isHome && !meganav) {
  hedclass = "home-header";
} else if (isHome && targetRegion === "US") {
  hedclass = "home-header";
}

// v2製品リスト
const v2List = ["kintone", "slash", "support_guide", "store", "store-jp"];
const v2Prod = v2List.includes(product);

// 言語設定
const langlen = allTranslations.length;
const baselang = langlen !== 0 ? `${lang}/` : "";

// ベースURL設定
const urlparts = baseURL.split("/");
let base = "/";
if (product !== "support_guide") {
  const productPos = urlparts.length - 2;
  base = `/${urlparts[productPos]}/`;
}
const baseLink = `${base}${lang}/`;

// 検索ボックス表示判定
let dispSbox = true;
if (pageType === "search_result") {
  dispSbox = false;
} else if (isHome && v2Prod) {
  dispSbox = false;
} else if (pageType === "gr6/home") {
  dispSbox = false;
} else if (previewSite) {
  dispSbox = false;
}

// 言語コード調整（Google検索用）
let glang = lang;
if (lang === "zh") {
  glang = "zh-CN";
} else if (lang === "zh-tw") {
  glang = "zh-TW";
}

// ロゴ表示判定
const showLogo = product === "kintone" || targetRegion === "US";
const logoAlt = `${productName} ${help}`;
const logoTitle = previewSite ? productName : `${siteName} ${help}`;
---

<div id="shield"></div>
<header id="header" class={`header ${hedclass}`}>
  <div id="head" class="header-wrap">
    <div class="logo-wrap">
      {!isHome && templateVersion === "2" && (
        <button id="tree-switch-mobile" class="tree-switch-mobile">
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
      )}
      <h1>
        <a class="logo-link" href={baseLink}>
          {showLogo ? (
            <img 
              class="logo-img" 
              src={`${base}${logo}`} 
              alt={logoAlt} 
              title={logoAlt}
            />
          ) : (
            <span class="logo-title">{logoTitle}</span>
          )}
        </a>
      </h1>
    </div>

    {dispSbox && (
      <Fragment>
        {templateVersion === "2" ? (
          <div id="search" class="search-wrap">
            <!-- SearchBox コンポーネントをここに配置 -->
          </div>
        ) : (
          <div id="search" class="search-wrap">
            <form 
              id="searchBox_form" 
              action={`${lang}/search_result.html`}
              onsubmit="if(document.getElementById('headerSearchBox_input').value==''){return false;}" 
              role="search"
            >
              <div class="searchbox">
                <input 
                  type="search" 
                  name="q" 
                  id="headerSearchBox_input" 
                  class="search-input home-search-input" 
                  role="searchbox" 
                  aria-label={searchWordLabel}
                  placeholder={enterKeywordsLabel}
                />
                <button 
                  type="submit" 
                  class="search-submit" 
                  data-disable-with="" 
                  aria-label={searchLabel}
                ></button>
                {!googleSearch && (
                  <input type="hidden" name="ct" value={searchAll} />
                )}
              </div>
            </form>
          </div>
        )}
        
        {googleSearch && templateVersion !== "2" && (
          <script 
            src="https://www.gstatic.com/prose/brand.js" 
            data-targetid="headerSearchBox_input" 
            data-hl={glang}
          ></script>
        )}
      </Fragment>
    )}

    {isTranslated && langSelector && (
      <div id="lang-selector-placeholder">
        <!-- LangSelector コンポーネントをここに配置 -->
      </div>
    )}
  </div>
</header> 