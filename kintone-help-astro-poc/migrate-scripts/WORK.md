# Hugo → Astro 変換スクリプト 作業ルール

## 🔴 重要: 作業開始前の必須確認事項

**すべての作業開始時に以下を実行してください:**

1. **このファイル（WORK.md）を読み、作業ルールを理解する**
2. **作業履歴の確認**: `kintone-help-astro-poc/migration-docs/0034_content-to-mdx-script/` 配下のドキュメントの内容を思い出せない場合、必ず参照し、隅々まで理解すること。
3. **ユーザーへのレスポンス開始時**: 必ず「作業原則: WORK.md の内容を理解してから作業を実施します」を含める

## 遵守するルール

### 1. 直接編集の絶対禁止

- **ユーザー指示**: 「直接編集は禁止です。絶対に禁止です。」
- **対応方法**: すべての修正は変換スクリプトまたはプリプロセッサで対応

### 2. 修正対応の判断基準

- **個別ファイル固有の問題** → プリプロセッサによる修正（`kintone-preprocessors.js`）
- **全体的な変換ロジックの問題** → 変換スクリプト自体の修正（各処理モジュール）

### 3. プリプロセッサ必須

- 変換実行時は常にプリプロセッサを指定
- 標準コマンド:
  ```bash
  npx tsx migrate-scripts/convert-content.ts \
    --preprocessor migrate-scripts/preprocessors/kintone-preprocessors.js \
    --image-path-from "/k/" \
    --image-path-to "/k/kintone/" \
    <入力ディレクトリ> \
    <出力ディレクトリ>
  ```

### 4. 正規表現の使用制限

- 基本は単純な文字列置換（`replaceAll`）を優先
- 正規表現はマルチライン処理など必要な場合のみ使用

## 作業フロー

### エラー発生時の対応手順

1. エラー内容とファイルを確認
2. 個別ファイル問題 or 全体ロジック問題かを判断
3. 適切な修正方法を選択・実装
4. テスト実行で修正確認
5. ドキュメント更新

### プリプロセッサルール追加時

```javascript
{
  filePath: "対象ファイルのパス",
  transform: (content) => {
    return content.replaceAll('問題のある文字列', '修正後の文字列');
  }
}
```

### 変換スクリプト修正時

- 該当する処理モジュール（html-processor.ts など）を修正
- 全ファイルに適用される処理として実装

## ドキュメント管理ルール

### 作業完了時の必須更新

1. **このファイル（WORK.md）**: 新しい問題パターンや対応方法を追加
2. **prompt.md**: 作業履歴の詳細を記録
3. **migrate-memo.md**: 全体的な進捗状況を更新

### ドキュメント場所

- **作業ルール**: `migrate-scripts/WORK.md`（このファイル）
- **詳細履歴**: `migration-docs/0034_content-to-mdx-script/prompt.md`
- **全体状況**: `migration-docs/migrate-memo.md`

## 継続作業の心構え

### 重要な認識

- この作業は「完成」するものではなく、継続的改善が必要
- 大量のファイルで類似のエラーが継続発生する
- 新しい問題パターンが継続的に発見される

### 対応方針

- 問題パターンを分類・体系化する
- 再利用可能な修正パターンを確立する
- ドキュメントを継続的に更新する

## 記憶喪失対策

このファイルは、記憶喪失時の作業復旧用です。作業開始時は必ずこのファイルと関連ドキュメントを確認し、現在の状況とルールを正確に把握してから作業を開始してください。

---

**最終更新**: 2025-01-02
**次回更新**: 新しい問題パターン発見時、または重要なルール変更時
