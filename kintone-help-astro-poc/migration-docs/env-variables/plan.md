# 環境変数移行計画

## 概要
Hugo の設定ファイル（hugo_jp.toml）から Astro の環境変数システム（.env）への移行計画

## 移行前の状況
- Hugo では `hugo_jp.toml` に全ての設定が記載されていた
- 言語別の設定は `[languages.ja.params]` のような階層構造で管理
- テンプレート内では `{{.Site.Params.xxx}}` でアクセス

## 移行後の構成

### 1. 環境変数ファイル (.env)
- Astro の標準的な環境変数システムを使用
- `PUBLIC_` プレフィックスでクライアント側でも利用可能に
- 言語別の設定は `PUBLIC_XXX_JA`、`PUBLIC_XXX_EN` のように接尾辞で管理

### 2. 型定義 (src/env.d.ts)
- TypeScript の型安全性を確保
- `ImportMetaEnv` インターフェースで全環境変数を定義
- 動的なキーにも対応（インデックスシグネチャ）

### 3. 環境変数ローダー (src/lib/env.ts)
- `getLocalizedEnvValue()`: 言語固有の環境変数を取得
- `buildEnvConfig()`: 環境変数から設定オブジェクトを構築
- `EnvConfig` 型: 設定オブジェクトの型定義

### 4. コンポーネントでの使用
- PageLayout.astro で `buildEnvConfig()` を呼び出し
- Head コンポーネントに `env` プロパティとして渡す
- 各コンポーネントは `env` プロパティから必要な値を参照

## 実装手順

1. ✅ hugo_jp.toml の内容を分析
2. ✅ .env ファイルを作成（環境変数の定義）
3. ✅ src/lib/env.ts を作成（環境変数ローダー）
4. ✅ src/env.d.ts を作成（TypeScript 型定義）
5. ✅ PageLayout.astro を修正（環境変数の読み込みと伝播）
6. ✅ Head コンポーネントに env プロパティを渡す

## 注意事項

### 命名規則
- 公開環境変数は `PUBLIC_` プレフィックスが必須
- 言語固有の設定は `_JA`、`_EN`、`_ZH`、`_ZH_TW` の接尾辞を使用
- アンダースコア区切りの大文字（SCREAMING_SNAKE_CASE）

### 型安全性
- env.d.ts で全ての環境変数を定義
- オプショナルな環境変数には `?` を付ける
- 動的なキーアクセスに対応するためインデックスシグネチャを追加

### デフォルト値
- 環境変数が未定義の場合は空文字列を返す
- 言語固有の値が見つからない場合は日本語設定をフォールバック

## 今後の課題
- [ ] 他のコンポーネントでの環境変数使用パターンの確立
- [ ] 開発環境と本番環境での環境変数の切り替え方法
- [ ] 環境変数のバリデーション機能の追加