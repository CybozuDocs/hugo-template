# Hugo Shortcodes → Astro コンポーネント移行 作業履歴

## ユーザーからの指示

```
Hugoのshortcodes配下のショートコードをAstroのコンポーネントに置き換えます。
- src/components 配下に作成します。
- すでに一部は作成済みなので、それはスキップしてください。

まずはプランニングから行います。
DOMの破壊的な変更は避け、既存の再現を重要視します。

ここまでのすべてのドキュメントや既存のコンポーネントなどを参照し、深く理解したうえでプランニングしてください。
プランニング内容を確認後、私の許可が出るまでコードの変更は禁止です。
勝手にコードを変更することは許容されません。
```

## 実行したアクション

### 1. 調査フェーズ

#### Hugo shortcodes の全体調査
- layouts/shortcodes/ 配下の 44 個のファイルを特定
- 既存 Astro コンポーネント 7 個との対応関係を確認
- 複雑度評価（簡単/中程度/高複雑）を実施

#### 既存実装の分析
```
移行済み（7個）:
- hint.html → Hint.astro
- note.html → Note.astro  
- reference.html → Reference.astro
- kintone.html → Kintone.astro
- enabled2.html → Enabled.astro
- wv_brk.html → Wovn.astro
- (新規) → Heading.astro
```

#### 移行対象の特定
```
残り 37 個のshortcode:
- フェーズ1（簡単）: 11個
- フェーズ2（中程度）: 15個  
- フェーズ3（高複雑）: 11個
```

### 2. プランニングフェーズ

#### product 固定化の影響分析
- kintone 固定により簡素化可能な shortcode を特定
- slash.html, store.html, service.html → kintone 固定出力
- Garoon 専用機能（tile_gr3.html, tile_gr4.html）の削除検討

#### 実装戦略の策定
- Props 設計パターンの定義（3パターン）
- アドモニション統一パターンの活用
- DOM 構造保持原則の厳守
- 段階的実装スケジュール（5週間）

#### ドキュメント構造の確立
- migration-docs/0032_shortcodes-migration/ ディレクトリ作成
- plan.md による詳細実行プランの策定
- 品質管理・リスク管理指針の明文化

### 3. 成果物

#### メインプランニングドキュメント
- **plan.md**: 37個のshortcode移行の詳細プラン
  - 複雑度別の分類・優先順位
  - 5週間の段階的実装スケジュール
  - Props設計パターンとアーキテクチャ指針
  - 品質管理・リスク管理戦略

#### 技術指針の確立
- DOM 構造の破壊的変更禁止原則
- product="kintone" 固定による簡素化ルール
- TypeScript 型安全性確保のガイドライン
- 既存 Astro パターン（Reference, Hint, Note）の活用

## 技術的洞察

### 1. 複雑度分析の要点
- **単純置換系（11個）**: 環境変数参照・ラッパーが中心
- **条件分岐系（15個）**: アドモニション・UI制御が中心
- **高複雑系（11個）**: 正規表現・CSV読み込み・動的処理

### 2. アーキテクチャパターンの継承
既存の Reference.astro, Hint.astro, Note.astro で確立済みの：
- アドモニション統一構造の再利用
- Props 最適化パターンの適用
- WOVN 翻訳統合手法の活用

### 3. product 固定化による簡素化効果
```
簡素化前: {{ if eq $.Site.Params.product "kintone" }}kintone{{ end }}
簡素化後: kintone（固定出力）
```

## リスク要因と対策

### 高リスク要素
1. **tile2.html**: 正規表現による複雑な文字列処理
2. **topics.html**: CSV 外部データ読み込み機能
3. **slash_*** シリーズ**: product 変更影響の不確実性

### 緩和策
- 高複雑度は単独作業日設定
- TODO 実装によるプレースホルダー先行実装
- 段階的リリース・テストの徹底

## 現在の状況

### 完了事項
- ✅ Hugo shortcodes 全体調査（44個）
- ✅ 既存 Astro コンポーネント状況確認（7個）
- ✅ 移行対象の特定・分類（37個）
- ✅ 実装プラン・スケジュール策定
- ✅ migration-docs/0032_shortcodes-migration/ 作成
- ✅ plan.md 詳細プラン完成

### 次のステップ（ユーザー許可待ち）
- [ ] プラン内容のユーザー確認・承認
- [ ] フェーズ1実装開始（11個の単純置換系）
- [ ] 段階的進捗管理とドキュメント更新

---
**ステータス**: プランニング完了 → ユーザー承認待ち  
**作成日時**: 2025年1月  
**推定総工数**: 4-5週間（37コンポーネント）