# env リファクタリング実行計画

## 概要

現在、環境変数（env）は PageLayout から buildEnvConfig を呼び出し、Props としてバケツリレーで渡されています。
これを、各コンポーネントから直接 import で取得できる形に変更します。

## 変更内容

### 1. env.ts の修正

- buildEnvConfig を env.ts 内部で呼び出す
- 結果を "env" という名前で export する  
- Readonly 型として編集不可にする

### 2. コンポーネントの修正

- env を Props で受け取っているすべての .astro ファイルを修正
- Props からの受け取りを削除し、直接 import に変更

## 実装手順

### ステップ 1: 現在の実装確認

1. src/lib/env.ts の現在の実装を確認
2. buildEnvConfig 関数の引数と返り値を理解

### ステップ 2: env.ts の修正

1. buildEnvConfig を内部で呼び出す
2. 結果を Readonly 型として export
3. 必要に応じてデフォルト値を設定

### ステップ 3: コンポーネントの特定と修正

1. すべての .astro ファイルを検索
2. env プロパティを Props で受け取っているファイルを特定
3. 各ファイルを以下のように修正：
   - Props の env 定義を削除
   - `import { env } from "@/lib/env"` を追加
   - env の参照箇所はそのまま維持

### ステップ 4: PageLayout.astro の修正

1. buildEnvConfig の import と呼び出しを削除
2. 子コンポーネントへの env Props 渡しを削除

## 注意事項

- env に含まれる個々のプロパティは変更しない
- キー・値は現状のまま維持
- プロパティ不足によるエラーは今回の対応範囲外
- あくまで Props 渡しから import への変更のみ

## 期待される効果

- Props のバケツリレーが解消される
- 各コンポーネントが必要に応じて直接 env を参照できる
- コードの可読性と保守性が向上

## リスクと対策

- **リスク**: buildEnvConfig が引数を受け取っていた場合の対応
- **対策**: デフォルト値を設定し、現在の挙動を維持

- **リスク**: 大量のファイル変更によるエラー
- **対策**: 段階的に変更し、都度ビルドテストを実施