{{- partial "head" . }}
{{- if eq $.Site.Params.TargetRegion "US" }}{{- partial "localemodal" . }}{{- end -}}
{{- partial "announcementbanner.html" . -}}
{{- partial "header" . }}
{{- $buildnum := (now.Format "2006010203") }}
<div class="page-pad page-pad-search"></div>
{{- if eq $.Site.Params.meganav true -}}
    {{- partial "meganav" . }}
{{- end -}}
<div class="page" >
    <div class="contents-wrap">
        <main class="main" role="main">
            {{- partial "breadcrumb" . }}
            <article id="search-result" class="search-result" >
                <h1>{{ partial "title" . }}</h1>
                <div id="searchResultContainer">
              {{- if eq $.Site.Params.TargetRegion "CN" }}
                {{- $ph := (i18n "Enter_keywords") }}
                {{- if eq $.Site.Params.product "kintone" }}
                  {{- $ph = (i18n "Search_example") }}
                {{- end }}
                {{- $lang := .Site.LanguageCode }}
                {{- if eq (hasPrefix $lang "zh-tw") true }}
                  {{- $lang = substr $lang 0 5 }}
                {{- else }}
                  {{- $lang = substr $lang 0 2 }}
                {{- end }}
                    <div class="mf_finder_container">
                {{- if eq $lang "zh-tw" }}
                    <script>
                    let callCnt = 0;
                    const replace_hant = () => {
                        callCnt++;
                        const disp = document.getElementsByClassName("mf-search-results_header");
                        const countElem  = document.getElementsByClassName("mf-search-results_header_results-count");
                        
                        if (disp && disp.length > 0 && countElem && countElem.length > 0) {
                          const start = document.getElementsByClassName("mf-search-results_header_results-start")[0].innerText;
                          const end   = document.getElementsByClassName("mf-search-results_header_results-end")[0].innerText;
                          const count = document.getElementsByClassName("mf-search-results_header_results-count")[0].innerText;
                          const word  = document.getElementsByClassName("mf-search-results_header_search-query")[0].innerText;
                          
                          disp[0].innerHTML = `顯示 ${start} - ${end} 共 ${count} 結果 "${word}"`;
                          callCnt = 999;
                        } else if (callCnt <= 3) {
                          setTimeout(replace_hant, 1000);
                        }
                    }
                    var handleCallback = () => {
                        setTimeout(replace_hant, 50);
                    }
                    </script>
                {{- end }}
                      <mf-search-box
                        lang="{{$lang}}"
                        ajax-url="https://finder.api.mf.marsflag.com/api/v1/finder_service/documents/fe060ed6/search"
                        input-placeholder="{{$ph}}"
                        imgsize-default="0"
                        category-all-text=""
                        category-default="{{ .Site.Params.search_all }}"
                        force-category-csv="{{ .Site.Params.search_categories }}"
                        doctype-hidden="true"
                        sort-hidden="true"
                        pagemax-hidden="true"
                        imgsize-hidden="true"
                        use-links="true"
                        use-clear-input-btn="true"
                {{- if eq $lang "zh-tw" }}
                        submit-btn-text="{{ i18n "search" }}"
                        submit-btn-title ="{{ i18n "search" }}"
                        use-links-category-text ="{{ i18n "Search_category"}}"
                {{- end }}
                      ></mf-search-box>
                      <mf-search-results
                        no-keyword-result
                        spellcheck-hidden
                {{- if eq $lang "zh-tw" }}
                        no-result-text="{{ i18n "Search_noresult"}}"
                        no-keyword-result-text="{{ i18n "Search_nokeyword"}}"
                        result-callback="handleCallback"
                {{- end }}
                      ></mf-search-results>
                    </div>
                    <script type="text/javascript">
                    !(function () {
                          var G = (window.GALFSRAM = window.GALFSRAM || {});
                          G.mfx = G.mfx || {};
                          G.mfx.router_mode = 'history'
                        })()
                    </script>
              {{- else }}
                    <div id="main_form">
                {{- if eq $.Site.Params.template_version "2" }}
                  {{- partial "searchbox" . }}
                {{- else }}
                        <div role="search" class="search-part">
                            <input type="search" v-model="search_words" v-on:keyup.enter="submit_button" class="search-words" v-bind:disabled="searching == true" aria-label='{{i18n "search_word"}}'>
                            <button role="button" class="search-button" v-on:click="submit_button" v-bind:disabled="searching == true" title='{{i18n "search"}}' aria-label='{{i18n "search"}}'><i class="fa fa-search" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div id="logo_place" class="search-logo">
                            {{- if eq .Site.Params.bing_search true }}
                                <span>{{ i18n "search_bing" }} (<a href="https://www.microsoft.com/en-gb/privacy/privacystatement" target="_blank">{{ i18n "search_bing_legal" }}</a>)</span>
                            {{- end }}
                        </div>
                {{- end }}
                        <div class="category-bar" v-bind:class="{ nodisp : initial }" v-cloak>
                            <span class="ctab" v-for="(ctab, index) in ctabs">
                                <input type="radio" name="category" class="category-tab" :id="'category'+(index)" v-model="cid" v-on:click="change_category(index)" :value="index">
                                <label :for="'category'+(index)" v-on:keydown.enter="key_down" role="tab" tabindex="0">[[ctab]]</label>
                            </span>
                        </div>
                        <div class="result" v-bind:class="{ nodisp : initial }" v-cloak>
                            <div class="item-total">[[total]] results<span class="current-position" v-bind:class="{ nodisp : pages.length <= 1 }">([[start]]-[[last]])</span></div>
                            <div v-for="item in items" class="items">
                                {{- if or ( eq $.Site.Params.google_search true ) }}
                                    <div class="item-title"><a v-bind:href="item.link" v-html="item.htmlTitle"></a></div>
                                    <div class="item-url">[[item.link]]</div>
                                    <div class="item-snippet" v-html="item.htmlSnippet"></div>
                                {{- else if eq $.Site.Params.bing_search true }}
                                    <div class="item-title"><a v-bind:href="item.url" v-html="item.name"></a></div>
                                    <div class="item-url">[[item.url]]</div>
                                    <div class="item-snippet" v-html="item.snippet"></div>
                                {{- end }}
                            </div>
                        </div>

                        <div class="page-navigation" role="navigation" aria-label="{{ i18n "Page_selection" }}" v-bind:class="{ nodisp : pages.length <= 1 }" v-cloak>
                            <hr class="partition">
                            <button role="button" class="page-index page-arrow" v-bind:disabled="current <= 0" v-on:click="go_prev" title='{{ i18n "Previous_page"}}' aria-label='{{ i18n "Previous_page"}}'><i class="fas fa-arrow-left" aria-hidden="true"></i></button>
                            <button role="button" v-for="page in pages" v-on:click="page_navigate(page)" class="page-index" v-bind:class="[ page - 1 == current ? 'current-page' : '' ]" v-bind:aria-selected="page - 1 == current" v-bind:title="page" v-bind:aria-label="page">[[page]]</button>
                            <button role="button" class="page-index page-arrow" v-bind:disabled="total == 0 || pages.length - 1 == current" v-on:click="go_next" title='{{ i18n "Next_page"}}' aria-label='{{ i18n "Next_page"}}'><i class="fas fa-arrow-right" aria-hidden="true"></i></button>
                        </div>

                        <div class="errmsg" v-bind:class="{ nodisp : initial }" v-cloak>[[error_message]]</div>
                    </div>
              {{- end }}
                </div>
            </article>
        </main>
    </div>
    {{ .Content }}
</div>
    {{ partial "footer" . }}
    {{- if eq $.Site.Params.TargetRegion "CN" }}
    <link rel="stylesheet" href="{{ printf "%s?%s" "stylesheets/mf_custom.css" $buildnum | relURL }}">
    <script src="https://ce.mf.marsflag.com/latest/js/mf-search.js" defer></script>
    <script type="text/javascript" src="{{ printf "%s?%s" "javascripts/mf_custom.js" $buildnum | relURL }}" defer></script>
    {{- else }}
        {{- $categories := (slice) }}
        {{- with $.Site.Params.google_search_tabs }}
            {{- $categories = trim $.Site.Params.google_search_tabs "\"" | safeJS}}
        {{- end }}
        {{- with $.Site.Params.bing_search_tabs }}
            {{- $categories = trim $.Site.Params.bing_search_tabs "\"" | safeJS}}
        {{- end }}
    <script>var category_list = {{$categories}};</script>
    <script type="text/javascript" src="{{ printf "%s?%s" "javascripts/helpsearch.js" $buildnum | relURL }}"></script>
    {{- end }}
  </body>
</html>
