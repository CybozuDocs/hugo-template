---
import Title from './Title.astro';

interface Props {
  env: {
    // Title コンポーネントで使用
  };
  page: {
    sections: Array<{
      relPermalink: string;
      weight: number;
      pages: Array<{
        relPermalink: string;
        weight: number;
        [key: string]: any;
      }>;
      [key: string]: any;
    }>;
  };
}

const { env, page } = Astro.props;

// セクションを重み順でソート
const sortedSections = page.sections.sort((a, b) => {
  const weightA = a.weight || 0;
  const weightB = b.weight || 0;
  return weightA - weightB;
});
---

<nav>
  <div class="preview_list_container">
    {sortedSections.map((section) => {
      // ページを重み順でソート
      const sortedPages = section.pages.sort((a, b) => {
        const weightA = a.weight || 0;
        const weightB = b.weight || 0;
        return weightA - weightB;
      });

      return (
        <div class="preview_list_item" role="presentation">
          <div class="preview_list_title">
            <a href={section.relPermalink}>
              <Title env={env} page={section} />
            </a>
          </div>
          <ul>
            {sortedPages.map((page) => (
              <li>
                <a href={page.relPermalink}>
                  <Title env={env} page={page} />
                </a>
              </li>
            ))}
          </ul>
        </div>
      );
    })}
  </div>
</nav>